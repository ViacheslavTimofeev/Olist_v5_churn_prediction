# Olist Churn Prediction

[![Python](https://img.shields.io/badge/python-3.13%2B-blue.svg)](#) [![License: MIT](https://img.shields.io/badge/License-MIT-green.svg)](#) [![Docs](https://img.shields.io/badge/docs-Sphinx-informational.svg)](#) [![MLflow](https://img.shields.io/badge/tracking-MLflow-lightgrey.svg)](#)

–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ **–æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤** –¥–ª—è –±—Ä–∞–∑–∏–ª—å—Å–∫–æ–≥–æ e‚Äëcommerce Olist. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ñ–æ—Ä–º–ª–µ–Ω –ø–æ —à–∞–±–ª–æ–Ω—É Cookiecutter Data Science –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω CLI‚Äë—Å–∫—Ä–∏–ø—Ç–∞–º–∏ (Typer), –∫–æ–Ω—Ñ–∏–≥–∞–º–∏ YAML, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–µ–∫–∏–Ω–≥–æ–º —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ MLflow. –î–æ–±–∞–≤–ª–µ–Ω—ã Jupyter-–Ω–æ—É—Ç–±—É–∫–∏ —Å–æ –≤—Å–µ–º–∏ —ç—Ç–∞–ø–∞–º–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

## üîë –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö** —á–µ—Ä–µ–∑ YAML‚Äë–º–∞–Ω–∏—Ñ–µ—Å—Ç, –æ—Ç—á—ë—Ç –æ–± –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö.
- **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ñ–∏—á–µ–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥**: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü, –≤—ã–±–æ—Ä —Å—Ç–æ–ª–±—Ü–æ–≤, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–ø—É—Å–∫–æ–≤, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤.
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è ¬´—Å–∫–µ–ª–µ—Ç–æ–≤¬ª** - –ø—Ä–∞–≤–∏–ª –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (suites)
- **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–∞ `churned`** –ø–æ –æ–∫–Ω—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (—Ä–∞–∑–º–µ—Ä –æ–∫–Ω–∞ –ø–æ –≤—ã–±–æ—Ä—É, default >120 –¥–Ω–µ–π).
- **Baseline‚Äë–º–æ–¥–µ–ª–∏** (scikit‚Äëlearn Pipeline, ColumnTransformer).
- **–ö—Ä–æ—Å—Å‚Äë–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫** (F1, Recall, ROC‚ÄëAUC –∏ –¥—Ä.) –≤ **MLflow**.
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Sphinx** —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π API‚Äë—Ä–∞–∑–¥–µ–ª–æ–≤.

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ artifacts           # –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ baseline
‚îú‚îÄ‚îÄ configs             # YAML-–∫–æ–Ω—Ñ–∏–≥–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ baseline.yaml
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ preprocessing_manifest.yaml   # –º–∞–Ω–∏—Ñ–µ—Å—Ç –¥–ª—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ validation_manifest.yaml   # –º–∞–Ω–∏—Ñ–µ—Å—Ç –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ data
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ interim         # –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ join/clean
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ processed       # –≥–æ—Ç–æ–≤—ã–µ –∫ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—é –¥–∞—Ç–∞—Å–µ—Ç—ã
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ raw             # –∏—Å—Ö–æ–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã Olist
‚îú‚îÄ‚îÄ docs                # Sphinx-–ø—Ä–æ–µ–∫—Ç (–∏—Å—Ç–æ—á–Ω–∏–∫–∏ RST)
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Makefile
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ _build          # —Å–±–æ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ make
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ api
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ commands.rst    # –æ–ø–∏—Å–∞–Ω–∏–µ CLI-–∫–æ–º–∞–Ω–¥
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ conf.py         # –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è —Å–±–æ—Ä–∫–∏ html
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ getting-started.rst
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ index.rst
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ make.bat
‚îú‚îÄ‚îÄ features
‚îú‚îÄ‚îÄ notebooks            # –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏ EDA
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ EDA
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ feature engineering
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ preprocessing
‚îú‚îÄ‚îÄ pyproject.toml
‚îú‚îÄ‚îÄ references
‚îú‚îÄ‚îÄ reports
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ figures          # –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ setup.py
‚îú‚îÄ‚îÄ src                  # –º–æ–¥—É–ª–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ olist_churn_prediction    # –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
‚îú‚îÄ‚îÄ typed_schemas         # —Ç–∏–ø—ã, –∫ –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ payments_types.yaml
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ product_measures_types.yaml
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ public_customers_types.yaml
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ public_data_types.yaml
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ sellers_types.yaml
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ translation_types.yaml
‚îî‚îÄ‚îÄ validations
    ‚îú‚îÄ‚îÄ reports
    ‚îî‚îÄ‚îÄ suites                     # "—Å–∫–µ–ª–µ—Ç—ã" –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
```

> –ü–∞–ø–∫–∏ `mlruns/` –∏ –±–æ–ª—å—à–∏–µ –±–∏–Ω–∞—Ä–Ω—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore`.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1) –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone git@github.com:ViacheslavTimofeev/Olist_v5_churn_prediction.git
cd <–≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>

conda env create -f environment.yml
conda activate olist-ml        # –∏–ª–∏ –∏–º—è –∏–∑ –ø–æ–ª—è `name:` –≤ –≤–∞—à–µ–º environment.yml

# –ø—Ä–∏–≤—è–∑–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∫ Jupyter
python -m ipykernel install --user --name olist-ml --display-name "olist-ml"

# –ª–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞
pip install -e .

# –ø—Ä–æ–≤–µ—Ä–∫–∞
python -c "import olist_churn_prediction as p; print('OK:', p.__name__)"
```

### 2) –î–∞–Ω–Ω—ã–µ
–°–∫–∞—á–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—ã Olist –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ **–∫–∞–∫ –µ—Å—Ç—å** –≤ `data/raw/`. –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –≤–∞—à–∏—Ö YAML‚Äë–∫–æ–Ω—Ñ–∏–≥–∞—Ö.

### 3) –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
–ú–∞–Ω–∏—Ñ–µ—Å—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏ –∫–∞–∫–∏–µ –ø–æ—Ä–æ–≥–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.
```yaml
# —á–∞—Å—Ç—å validation_manifest.yaml
defaults:
  cast:
    mode: strict  # –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–∞–≤–∞ –∫–æ–ª–æ–Ω–æ–∫, –∏–¥—ë—Ç –ø—Ä–æ—Ç–∏–≤ —Å—Ö–µ–º—ã —Ç–∏–ø–æ–≤ (–ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ typed_schemas/*.yaml)
    keep_unknown_columns: false # –ø—Ä–∏ false –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –Ω–µ–∑–∞–¥–µ–∫–ª–∞—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ (–ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ typed_schemas/*.yaml)
    csv_sep: ","
    output_dir: data/interim
  validate:
    null_delta_pp: 5.0  # –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–æ—Å—Ç –¥–æ–ª–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –±–∞–∑–æ–≤–æ–π (–∏–∑ suite)
    new_cat_ratio: 0.02  # –¥–æ–ª—è —Å—Ç—Ä–æ–∫ —Å –Ω–æ–≤—ã–º–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏, –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Äî –æ—à–∏–±–∫–∞
    oob_ratio: 0.01  # –¥–æ–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –≤–Ω–µ —á–∏—Å–ª–æ–≤—ã—Ö/–¥–∞—Ç–æ–≤—ã—Ö –≥—Ä–∞–Ω–∏—Ü (–∏–∑ suite), –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ ‚Äî –æ—à–∏–±–∫–∞
    strict_structure: true  # –µ—Å–ª–∏ true, –Ω–∞–ª–∏—á–∏–µ –ª–∏—à–Ω–∏—Ö –∫–æ–ª–æ–Ω–æ–∫ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ suite ‚Äî –æ—à–∏–±–∫–∞ (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ ‚Äî –≤—Å–µ–≥–¥–∞ –æ—à–∏–±–∫–∞)
    dayfirst: false  # –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
    sample: null  # –¥–æ–ª—è –æ—Ç –æ–±—â–µ–≥–æ –¥–ª—è –≤—ã–±–æ—Ä–∫–∏, null - –≤–∑—è—Ç—å –≤–µ—Å—å –¥–∞—Ç–∞—Å–µ—Ç

datasets:  # –∏–º–µ–Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –¥–ª—è –Ω–µ–≥–æ —ç—Ç–∞–ø –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  - name: public_customers
    path: "data/raw/olist_public_dataset_v2_customers.csv"  # –ø—É—Ç—å –∫ —Å—ã—Ä–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É
    cast:
      schema: typed_schemas/public_customers_types.yaml
      output: data/interim/cli_related/typed/public_customers_typed.parquet 
      mode: strict
    validate:
      suite: "validations/suites/public_customers.json"
```
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
# –¥–ª—è –æ–¥–Ω–æ–≥–æ
python -m olist_churn_prediction.validator_cli validate \
       <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–∞—Ç–∞—Å–µ—Ç–∞ –Ω–∞ –≤—Ö–æ–¥> \
       <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å "—Å–∫–µ–ª–µ—Ç–∞" –¥–ª—è —Å–≤–µ—Ä–∫–∏>

# –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–∑—É
python -m olist_churn_prediction.validator_cli validate-all \
       <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏>
```
–ü—Ä–∏–º–µ—Ä:
```bash
# –¥–ª—è –æ–¥–Ω–æ–≥–æ
python -m olist_churn_prediction.validator_cli validate \
       data/raw/olist_public_dataset_v2.csv \
       validations/suites/public_data.json

# –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–∑—É
python -m olist_churn_prediction.validator_cli validate-all \
       configs/validation_manifest.yaml
```
### 4) –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Ç–∏–ø–∞–º
–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –æ–ø–∏—Å–∞–Ω–Ω—ã–º –≤ –Ω–∏—Ö —Ç–∏–ø–∞–º –¥–∞–Ω–Ω—ã—Ö. –ú–∞–Ω–∏—Ñ–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –≤ –ø–∞–ø–∫–µ typed_schemas.
```yaml
# –ø—Ä–∏–º–µ—Ä —Å—Ö–µ–º—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã payments
schema:
  order_id:  # –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏
    type: string  # —Ç–∏–ø –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è. –î–æ—Å—Ç—É–ø–Ω–æ int, float, string, bool, datetime (–º–æ–∂–Ω–æ —Å timezone), category
  installments:
    type: int
    nullable: false  # –ø—Ä–∏ True –≤–µ—Ä–Ω–µ—Ç Int64, –ø—Ä–∏ False - int64
  sequential:
    type: int
    nullable: false
  payment_type:
    type: string
  value:
    type: float
  date:
    type: datetime
    format: "%Y-%m-%d %H:%M:%S.%f"  # —Ñ–æ—Ä–º–∞—Ç –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –º–µ—Ç–æ–¥–æ–º pd.to_datetime()
    drop_tz: true
options:
  mode: strict      # strict | coerce
  keep_unknown_columns: false
```
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
# –¥–ª—è –æ–¥–Ω–æ–≥–æ
python -m olist_churn_prediction.types_cli cast \
       <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Å—ã—Ä–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É> \
       --schema <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç—É —Å —Ç–∏–ø–∞–º–∏> \
       --output <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è>

# –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–∑—É
python -m olist_churn_prediction.types_cli cast-all \
       <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏>
```
–ü—Ä–∏–º–µ—Ä:
```bash
# –¥–ª—è –æ–¥–Ω–æ–≥–æ
python -m olist_churn_prediction.types_cli cast \
       data/raw/payments_olist_public_dataset.csv \
       --schema typed_schemas/payments_types.yaml \
       --output data/interim/cli_related/typed/payments_typed.parquet

# –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–∑—É
python -m olist_churn_prediction.types_cli cast-all \
       configs/validation_manifest.yaml
```

### 5) –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ñ–∏—á–∏
–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞ –¥–ª—è –≤—ã–±–æ—Ä–∞, –æ—á–∏—Å—Ç–∫–∏ –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–π.

–ß–∏—Å—Ç–∫–∞ –∏ –≤—ã–±–æ—Ä:
```yaml
# —á–∞—Å—Ç—å preprocessing_manifest.yaml
datasets:
  - name: public_data_basic
    input: data/interim/cli_related/typed/public_data_typed.parquet  # –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –¥–∞—Ç–∞—Å–µ—Ç—É
    sample: null  # –¥–æ–ª—è –æ—Ç –≤—Å–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞ –¥–ª—è –≤–∑—è—Ç–∏—è (–≤—ã–±–æ—Ä–∫–∞)
    steps:
      - op: drop_columns  # —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫
        cols: [customer_zip_code_prefix]
      - op: drop_duplicates  # —É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        subset: all  # –≤–∑—è—Ç—å –≤—Å–µ –∫–æ–ª–æ–Ω–∫–∏
        keep: first  # –æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –¥—É–±–ª–∏–∫–∞—Ç
        ignore_index: true
      - op: dropna_columns  # —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤
        cols: [order_status]
        min_missing_ratio: 0.4  # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ª—è –ø—Ä–æ–ø—É—Å–∫–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
      - op: dropna_rows  # —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –ø—Ä–æ–ø—É—Å–∫–æ–≤
        subset: [order_id]
        how: any  # –ø—Ä–∏ –ª—é–±–æ–º –ø—Ä–æ–ø—É—Å–∫–µ
      - op: lowercase_categoricals  # –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
        cat_cols: [order_status]
      - op: disambiguate_city_state  # —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ—Ä–æ–¥–æ–≤ (—Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é preprocessing_cli.py)
        city_col: customer_city
        state_col: customer_state
        suffix_sep: "_"  # —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª
      - op: rename_columns  # –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫
        mapping:
          product_name_lenght: product_name_length
          product_description_lenght: product_description_length
      - op: groupby_aggregate  # –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ —É—Å–ª–æ–≤–∏—è–º
        by: order_id
        sum_cols:   [order_products_value, order_freight_value]  # —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
        mean_cols:  [product_name_length, product_description_length]  # —Å—Ä–µ–¥–Ω–µ–µ
        min_cols:   [review_creation_date, review_answer_timestamp]  # –º–∏–Ω–∏–º—É–º
        first_for_rest: true   # –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∞–≥—Ä–µ–≥–∏—Ä—É–µ–º –∫–∞–∫ first
    output: data/interim/cli_related/basic/public_data_basic.parquet  # –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
```
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–∞–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
```bash
# –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–∑—É
python -m olist_churn_prediction.preprocessing_cli run \
       <–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –º–∞–Ω–∏—Ñ–µ—Å—Ç—É –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞>
```
–ó–∞–ø—É—Å–∫:
```bash
# –¥–ª—è –≤—Å–µ—Ö —Å—Ä–∞–∑—É
python -m olist_churn_prediction.preprocessing_cli run \
       configs/preprocessing_manifest.yaml
```
–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ:
```yaml
# —á–∞—Å—Ç—å preprocessing_manifest.yaml
datasets:
  - name: master_basic
    input: data/interim/cli_related/basic/public_data_basic.parquet  # –±–∞–∑–∞
    steps:
      - op: join
        right: data/interim/cli_related/basic/payments_basic.parquet  # –∫–∞–∫–æ–π –¥–∞—Ç–∞—Å–µ—Ç –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
        on: [order_id]  # –ø–æ –∫–∞–∫–æ–π –∫–æ–ª–æ–Ω–∫–µ –æ–±—ä–µ–¥–∏–Ω—è–µ–º
        how: left  # –º–µ—Ç–æ–¥ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
        suffix_right: _pay  # —Å—É—Ñ—Ñ–∏–∫—Å –¥–ª—è –∫–æ–ª–æ–Ω–æ–∫ –ø–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

      - op: join
        right: data/interim/cli_related/basic/product_measures_basic.parquet
        on: [product_id]
        how: left
        suffix_right: _prod
    output: data/processed/cli_related/master_basic.parquet  # –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –Ω–µ–æ—á–∏—â–µ–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç

  - name: master_clean  # —á–∏—Å—Ç–∫–∞
    input: data/processed/cli_related/master_basic.parquet
    steps:  # —à–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
      - op: drop_duplicates  
        subset: all
      - op: drop_columns
        cols: [review_comment_message, review_comment_title, order_status]
      - op: dropna_rows
        how: any
    output: data/processed/cli_related/master_clean.parquet  # –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —á–∏—Å—Ç—ã–π –¥–∞—Ç–∞—Å–µ—Ç
```
### 6) –°–æ–∑–¥–∞–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `churned`

–í–∞—Ä–∏–∞–Ω—Ç 1 (default, –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–æ):
```yaml
# —á–∞—Å—Ç—å preprocessing_manifest.yaml
- name: master_clean_churned
    input: data/processed/cli_related/master_clean.parquet

    steps:
      - op: make_label
        customer_col: customer_id
        purchase_ts_col: order_purchase_timestamp
        target_col: churned
        horizon_days: 120
        reference_date: max             # –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞
        filter_status_col: order_status
        keep_statuses: [delivered]      # –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∫–æ–π "delivered, shipped"

    output: data/processed/cli_related/master_clean_churned.parquet
```
–í–∞—Ä–∏–∞–Ω—Ç 2 (—Ç—Ä–µ–±—É–µ—Ç —É–∂–µ –≥–æ—Ç–æ–≤–æ–≥–æ master_clean):
```bash
# –í–ê–ñ–ù–û!: –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–∞ master_clean –ø–æ—Å–ª–µ –≤—Å–µ—Ö join-–æ–≤. –î–ª—è –ø–æ—è—Å–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥ —Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é preprocessing_cli.make_label
python src/olist_churn_prediction/preprocessing_cli.py label \
       --input-path data/interim/master_basic.parquet \
       --output-path data/processed/master_with_target.parquet \
       --customer-col customer_id \
       --purchase-ts-col order_purchase_timestamp \
       --target-col churned \
       --horizon-days 120 \
       --reference-date max \
       --filter-status-col order_status \
       --keep-statuses delivered
```
–í–∞—Ä–∏–∞–Ω—Ç 3 (–≤—Ä—É—á–Ω—É—é –≤ –Ω–æ—É—Ç–±—É–∫–µ, –ø—Ä–∏–º–µ—Ä –≤ target_creation.ipynb):
```python
import pandas as pd

df = pd.read_parquet("data/processed/baseline.parquet")
ref = df["order_purchase_timestamp"].max()
last = df.groupby("customer_id")["order_purchase_timestamp"].max().reset_index()
last["days_since_last_order"] = (ref - last["order_purchase_timestamp"]).dt.days
last["churned"] = (last["days_since_last_order"] > 120).astype(int)  # –≤–∞–∂–Ω–æ: astype(int)

df = df.merge(last[["customer_id","churned"]], on="customer_id", how="left")
df["churned"].fillna(0, inplace=True)  # –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
```
–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –¥–∞—Ç–∞—Å–µ—Ç –≤ `data/processed/`.

### 7) Baseline‚Äë–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫—Ä–æ—Å—Å‚Äë–≤–∞–ª–∏–¥–∞—Ü–∏—è
–ß–∞—Å—Ç—å, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ baseline-–¥–∞—Ç–∞—Å–µ—Ç–∞
```yaml
# —á–∞—Å—Ç—å preprocessing_manifest.yaml
colsets:  # –∫–∞–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤–∫–ª—é—á–∞—Ç—å –≤ baseline
  baseline: &baseline_cols
    - customer_state
    - seller_state
    - order_products_value

datasets:
  - name: baseline_dataset
    input: data/processed/cli_related/master_clean_churned.parquet  # churned-–¥–∞—Ç–∞—Å–µ—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é CLI
    steps:
      - op: select_columns
        include: *baseline_cols  # –∫–∞–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤–∫–ª—é—á–∏—Ç—å
    output: data/processed/baseline_dataset.parquet  # –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤—ã–π –∫ –æ–±—É—á–µ–Ω–∏—é –¥–∞—Ç–∞—Å–µ—Ç
```
–ß–∞—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏
```yaml
# —á–∞—Å—Ç—å baseline.yaml
random_state: 42
cv:
  folds: 5
  shuffle: true

features:
  numeric: [feat_1, feat_2, feat_3]
  categorical: [customer_state, product_category_name_english]

model:
  name: rf
  params:
    n_estimators: 300
    max_depth: 12
    n_jobs: -1

metrics: [f1, recall, roc_auc]
log_model_artifact: false   # —á—Ç–æ–±—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç—è–∂–µ–ª—ã–π pickle
```
–ó–∞–ø—É—Å–∫ CV/Train:
```bash
python -m olist_churn_prediction.baseline_cli cv --config configs/baseline.yaml
python -m olist_churn_prediction.baseline_cli train --config configs/baseline.yaml
```

### 8) –¢—Ä–µ–∫–∏–Ω–≥ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ (MLflow)
```bash
mlflow ui --backend-store-uri mlruns
# –∑–∞—Ç–µ–º –æ—Ç–∫—Ä–æ–π—Ç–µ http://127.0.0.1:5000
```
–°–æ–≤–µ—Ç—ã: –∏–∑–±–µ–≥–∞–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤; –¥–µ—Ä–∂–∏—Ç–µ `mlruns/` –≤–Ω–µ –≥–∏—Ç–∞.

### 9) –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```bash
# Linux/Mac
make -C docs html
# Windows (PowerShell)
cd docs; .\make.bat html
```
–°–æ–±—Ä–∞–Ω–Ω—ã–µ HTML‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ—è–≤—è—Ç—Å—è –≤ `docs/_build/html`.

---

## ‚öôÔ∏è Makefile **(–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)**
–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ü–µ–ª–∏ (–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥ —Å–µ–±—è):
```
make data        # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞/–∑–∞–≥—Ä—É–∑–∫–∞ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
make validate    # –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ manifest.yaml
make features    # –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞/—Ñ–∏—á–∏
make train       # –∑–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è/–∫—Ä–æ—Å—Å-–≤–∞–ª–∏–¥–∞—Ü–∏–∏
make docs        # —Å–±–æ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
```

---

## üß™ –¢–µ—Å—Ç—ã –∏ —Å—Ç–∏–ª—å
- `pytest` –¥–ª—è –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (`tests/`). **(–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)**
- `black`, `isort`, `flake8` –∏ `pre-commit` –¥–ª—è –µ–¥–∏–Ω–æ–≥–æ —Å—Ç–∏–ª—è.

---

## üó∫Ô∏è Roadmap
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–∞–π–ø–ª–∞–π–Ω —Ñ–∏—á–µ–π–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥–∞ (–ª–∞–≥–∏, –∞–≥—Ä–µ–≥–∞—Ü–∏–∏, OOF target encoding).
- [ ] –î–æ–±–∞–≤–∏—Ç—å Optuna‚Äë—Ç—é–Ω–∏–Ω–≥ (XGBoost/LightGBM/CatBoost) —Å recall –∏ macro‚ÄëF1.
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –≤ S3/MinIO, CI/CD (GitHub Actions), Docker‚Äë–æ–±—Ä–∞–∑.
- [ ] –£–ª—É—á—à–∏—Ç—å Sphinx‚Äë–¥–æ–∫–∏: API‚Äë—Ä–∞–∑–¥–µ–ª—ã, –ø—Ä–∏–º–µ—Ä—ã CLI, –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–∞–π–ø–ª–∞–π–Ω–∞.

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ MIT (—Å–º. `LICENSE`).

---

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
- –®–∞–±–ª–æ–Ω: Cookiecutter Data Science.
- –°–æ–æ–±—â–µ—Å—Ç–≤–æ Olist –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ –¥–∞—Ç–∞—Å–µ—Ç—ã.